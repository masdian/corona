head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(q_ord = sum(q_ord),
dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
write.csv(q4, "~/Dayat/2019/2019.csv")
db <- NULL
path = "~/Dayat/2020/2020_kup 1.xlsx"
sheets <- excel_sheets(path)
sheets
db1 <- map_dfr(sheets, ~read_excel(path = path,
sheet = .x))
db <- bind_rows(db, db1)
path = "~/Dayat/2020/2020_kup 2.xlsx"
sheets <- excel_sheets(path)
sheets
db1 <- map_dfr(sheets, ~read_excel(path = path,
sheet = .x))
db <- bind_rows(db, db1)
path = "~/Dayat/2020/2020_kup 3.xlsx"
sheets <- excel_sheets(path)
sheets
db1 <- map_dfr(sheets, ~read_excel(path = path,
sheet = .x))
db <- bind_rows(db, db1)
dim(db)
db$ord_dt <- ymd(db$ord_dt)
db <- db %>%
group_by(cpn_cd,cpn_descr,ord_dt) %>%
summarise(sum_salesExcludedTax = sum(salesExcludedTax),
sum_COGS = sum(COGS))
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(q_ord = sum(q_ord),
dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
write.csv(q4, "~/Dayat/2020/2020.csv")
db <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
dim(db)
db$ord_dt <- ymd(db$ord_dt)
names(db)
library(readxl)
library(dplyr)
library(lubridate)
lbr <- read_excel("~/Dayat/libur.xlsx")
lbr
lbr$date <- ymd(lbr$date)
lbr
db <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
dim(db)
db$ord_dt <- ymd(db$ord_dt)
db <- db %>%
group_by(cpn_cd,cpn_descr,ord_dt) %>%
summarise(tot_ord = n(),
sum_salesExcludedTax = sum(salesExcludedTax),
sum_COGS = sum(COGS))
head(db)
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
head(q1)
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(q_ord = sum(q_ord),
dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
head(q3)
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
select(-q_ord)
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
select(-q_ord) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(q_ord = sum(q_ord),
dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
head(q4)
dim(q4)
head(liburan)
head(lbr)
names(lbr)
names(lbr)
names(q4)
q4 <- left_join(q4, lbr[,c("date", "month", "week_of_month", "day", "holiday",
"type_of_holiday", "weekend", "long_weekend", "weekday")],
by = c("ord_dt" = "date"))
dim(q4)
write.csv(q4, "~/Dayat/2016/2016.csv")
names(q3)
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "group", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
q4 <- left_join(q4, lbr[,c("date", "month", "week_of_month", "day", "holiday",
"type_of_holiday", "weekend", "long_weekend", "weekday")],
by = c("ord_dt" = "date"))
write.csv(q4, "~/Dayat/2016/2016.csv")
setwd("~/Github Publish/Corona")
lbr <- read_excel("~/Dayat/libur.xlsx")
lbr$date <- ymd(lbr$date)
db <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
dim(db)
db$ord_dt <- ymd(db$ord_dt)
names(db)
db <- db %>%
group_by(cpn_cd,cpn_descr,ord_dt) %>%
summarise(ord = n(),
sales = sum(salesExcludedTax),
COGS = sum(COGS))
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
select(-q_ord) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
head(q1)
head(q3)
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "group", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
head(q4)
dim(db)
dim(q4)
head(db)
raw <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
head(raw)
length(unique(raw$store_no))
raw <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
db <- raw
dim(db)
db$ord_dt <- ymd(db$ord_dt)
db <- db %>%
group_by(cpn_cd,cpn_descr,ord_dt) %>%
summarise(ord = n(),
sales = sum(salesExcludedTax),
COGS = sum(COGS))
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
select(-q_ord) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "group", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
q4 <- left_join(q4, lbr[,c("date", "month", "week_of_month", "day", "holiday",
"type_of_holiday", "weekend", "long_weekend", "weekday")],
by = c("ord_dt" = "date"))
head(q4)
q5 <- q4 %>%
group_by(cpn_cd, group) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS))
head(q5)
q5 <- q4 %>%
group_by(cpn_cd, group, duration) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS)) %>%
mutate(at = sales/ord,
at = ord/(duration * length(unique(raw$store_no))))
head(q5)
q5 <- q4 %>%
group_by(cpn_cd, group, duration) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS)) %>%
mutate(at = sales/ord,
adt = ord/(duration * length(unique(raw$store_no))))
head(q5)
head(q4)
names(q4)
dim(q5)
dim(q4)
head(q5)
q4 <- left_join(q4[,-c("ord", "sales", "COGS")], q5[,c("cpn_cd", "group", "at", "adt")],
by = c("cpn_cd" = "cpn_cd", "group" = "group"))
head(q3)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
head(q3)
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "group", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
head(q4)
q5 <- q4 %>%
group_by(cpn_cd, group, duration) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS)) %>%
mutate(at = sales/ord,
adt = ord/(duration * length(unique(raw$store_no))))
head(q5)
head(q4)
q4 <- left_join(q4[,c(1,2,3,7,8)], q5[,c(1,2,5,7,8)],
by = c("cpn_cd" = "cpn_cd", "group" = "group"))
dim(q4)
head(q4)
q4 <- left_join(q4, lbr[,c("date", "month", "week_of_month", "day", "holiday",
"type_of_holiday", "weekend", "long_weekend", "weekday")],
by = c("ord_dt" = "date"))
write.csv(q4, "~/Dayat/2016/2016.csv")
?month
month(db$ord_dt)
raw <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
db <- raw
dim(db)
db$ord_dt <- ymd(db$ord_dt)
db <- db %>%
group_by(cpn_cd,cpn_descr,ord_dt) %>%
summarise(ord = n(),
sales = sum(salesExcludedTax),
COGS = sum(COGS))
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
select(-q_ord) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
head(q2)
q2$year <- year(q2$dt_max)
q2$month <- month(q2$dt_max)
head(q2)
str <- read_excel("~/Dayat/store.xlsx")
str
str <- read_excel("~/Dayat/store.xlsx")
str
q2 <- left_join(q2, str, by = c("year" = "Tahun", "month" = "Bulan"))
head(q2)
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "store", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
head(q3)
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "group", "store", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
q5 <- q4 %>%
group_by(cpn_cd, group, duration) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS)) %>%
mutate(at = sales/ord,
adt = ord/(duration * store))
head(q4)
q5 <- q4 %>%
group_by(cpn_cd, group, store, duration) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS)) %>%
mutate(at = sales/ord,
adt = ord/(duration * store))
head(q5)
head(q4)
q4 <- left_join(q4[,c(1,2,3,7,9)], q5[,c(1,2,6,8,9)],
by = c("cpn_cd" = "cpn_cd", "group" = "group"))
names(q4)
write.csv(q4, "~/Dayat/2016/2016.csv")
q4 <- left_join(q4, lbr[,c("date", "month", "week_of_month", "day", "holiday",
"type_of_holiday", "weekend", "long_weekend", "weekday")],
by = c("ord_dt" = "date"))
write.csv(q4, "~/Dayat/2016/2016.csv")
db <- read_excel("~/Dayat/2016/2016_kup 1-12.xlsx")
dim(db)
db$ord_dt <- ymd(db$ord_dt)
#db_16$Year <- strftime(db_16$ord_dt, "%Y")
#db_16$Month <- strftime(db_16$ord_dt, "%m")
db <- db %>%
group_by(cpn_cd,cpn_descr,ord_dt) %>%
summarise(ord = n(),
sales = sum(salesExcludedTax),
COGS = sum(COGS))
q1 <- db %>%
group_by(cpn_cd, ord_dt) %>%
summarise(q_ord = n()) %>%
select(-q_ord) %>%
arrange(desc(cpn_cd, -ord_dt))
head(q1)
dif <- NULL
for (i in 2:nrow(q1)) {
dif[i] <- q1$ord_dt[i] - q1$ord_dt[i-1]
}
dif[1] <- 1
q1$dif <- dif
head(q1)
group <- NULL
a <- 1
for (i in 1:nrow(q1)) {
if (q1$dif[i] == 1) {
b <- 0
a <- a + b
group[i] <- a
} else {
b <- 1
a <- a + b
group[i] <- a
}
}
q1$group <- group
q2 <- q1 %>%
group_by(cpn_cd, group) %>%
summarise(dt_min = min(ord_dt),
dt_max = max(ord_dt))
q2$duration <- as.numeric(q2$dt_max - q2$dt_min + 1)
q2$year <- year(q2$dt_max)
q2$month <- month(q2$dt_max)
head(q2)
q2 <- left_join(q2, str, by = c("year" = "Tahun", "month" = "Bulan"))
q3 <- left_join(x = q1, y = q2[,c("cpn_cd", "group", "store", "duration")], by = c("cpn_cd" = "cpn_cd", "group" = "group"))
q4 <- left_join(db, q3[, c("cpn_cd", "ord_dt", "group", "store", "duration")],
by = c("cpn_cd" = "cpn_cd", "ord_dt" = "ord_dt"))
q5 <- q4 %>%
group_by(cpn_cd, group, store, duration) %>%
summarise(ord = sum(ord),
sales = sum(sales),
COGS = sum(COGS)) %>%
mutate(at = sales/ord,
adt = ord/(duration * store))
q4 <- left_join(q4[,c(1,2,3,7,9)], q5[,c(1,2,6,8,9)],
by = c("cpn_cd" = "cpn_cd", "group" = "group"))
q4 <- left_join(q4, lbr[,c("date", "month", "week_of_month", "day", "holiday",
"type_of_holiday", "weekend", "long_weekend", "weekday")],
by = c("ord_dt" = "date"))
write.csv(q4, "~/Dayat/2016/2016.csv")
